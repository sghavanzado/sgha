2025-03-23 21:38:09,431 ERROR: Exception on /clients/ [POST] [in /Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/flask/app.py:875]
Traceback (most recent call last):
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2115, in _exec_insertmany_context
    dialect.do_execute(
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "clients_nif_key"
DETAIL:  Key (nif)=(987654321) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/Documents/Develop/backup/sgha/backend/routes/client_routes.py", line 35, in create_client
    db.session.commit()
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py", line 599, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4353, in flush
    self._flush(objects)
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4488, in _flush
    with util.safe_reraise():
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4449, in _flush
    flush_context.execute()
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2123, in _exec_insertmany_context
    self._handle_dbapi_exception(
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2115, in _exec_insertmany_context
    dialect.do_execute(
  File "/Users/mcc/.virtualenvs/sgha/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "clients_nif_key"
DETAIL:  Key (nif)=(987654321) already exists.

[SQL: INSERT INTO clients (name, nif, address, city, state, country, phone, email, contact_first_name, contact_last_name, contact_email, contact_phone_number, payment_terms, bank_name, iban_number) SELECT p0::VARCHAR, p1::VARCHAR, p2::VARCHAR, p3::VARCHAR, ... 3022 characters truncated ... p10, p11, p12, p13, p14, sen_counter) ORDER BY sen_counter RETURNING clients.id, clients.id AS id__1]
[parameters: {'email__0': 'john.doe@example.com', 'contact_email__0': 'john.doe@example.com', 'country__0': 'USA', 'nif__0': '123456789', 'iban_number__0': 'US12345678901234567890', 'city__0': 'New York', 'state__0': 'NY', 'name__0': 'John Doe', 'address__0': '123 Main St', 'contact_last_name__0': 'Doe', 'contact_phone_number__0': '123-456-7890', 'bank_name__0': 'Bank of America', 'payment_terms__0': 'Net 30', 'phone__0': '123-456-7890', 'contact_first_name__0': 'John', 'email__1': 'jane.smith@example.com', 'contact_email__1': 'jane.smith@example.com', 'country__1': 'USA', 'nif__1': '987654321', 'iban_number__1': 'US98765432109876543210', 'city__1': 'Los Angeles', 'state__1': 'CA', 'name__1': 'Jane Smith', 'address__1': '456 Elm St', 'contact_last_name__1': 'Smith', 'contact_phone_number__1': '987-654-3210', 'bank_name__1': 'Chase Bank', 'payment_terms__1': 'Net 15', 'phone__1': '987-654-3210', 'contact_first_name__1': 'Jane', 'email__2': 'alice.johnson@example.com', 'contact_email__2': 'alice.johnson@example.com', 'country__2': 'USA', 'nif__2': '456123789', 'iban_number__2': 'US45612378901234567890', 'city__2': 'Chicago', 'state__2': 'IL', 'name__2': 'Alice Johnson', 'address__2': '789 Pine St', 'contact_last_name__2': 'Johnson', 'contact_phone_number__2': '456-123-7890', 'bank_name__2': 'Wells Fargo', 'payment_terms__2': 'Net 45', 'phone__2': '456-123-7890', 'contact_first_name__2': 'Alice', 'email__3': 'bob.brown@example.com', 'contact_email__3': 'bob.brown@example.com', 'country__3': 'USA', 'nif__3': '321654987', 'iban_number__3': 'US32165498701234567890' ... 50 parameters truncated ... 'contact_phone_number__6': '159-753-4860', 'bank_name__6': 'Bank of Texas', 'payment_terms__6': 'Net 30', 'phone__6': '159-753-4860', 'contact_first_name__6': 'Ethan', 'email__7': 'fiona.green@example.com', 'contact_email__7': 'fiona.green@example.com', 'country__7': 'USA', 'nif__7': '753159486', 'iban_number__7': 'US75315948601234567890', 'city__7': 'San Diego', 'state__7': 'CA', 'name__7': 'Fiona Green', 'address__7': '753 Willow St', 'contact_last_name__7': 'Green', 'contact_phone_number__7': '753-159-4860', 'bank_name__7': 'Union Bank', 'payment_terms__7': 'Net 45', 'phone__7': '753-159-4860', 'contact_first_name__7': 'Fiona', 'email__8': 'george.harris@example.com', 'contact_email__8': 'george.harris@example.com', 'country__8': 'USA', 'nif__8': '951357486', 'iban_number__8': 'US95135748601234567890', 'city__8': 'Dallas', 'state__8': 'TX', 'name__8': 'George Harris', 'address__8': '951 Maple St', 'contact_last_name__8': 'Harris', 'contact_phone_number__8': '951-357-4860', 'bank_name__8': 'Regions Bank', 'payment_terms__8': 'Net 60', 'phone__8': '951-357-4860', 'contact_first_name__8': 'George', 'email__9': 'hannah.johnson@example.com', 'contact_email__9': 'hannah.johnson@example.com', 'country__9': 'USA', 'nif__9': '357951486', 'iban_number__9': 'US35795148601234567890', 'city__9': 'San Jose', 'state__9': 'CA', 'name__9': 'Hannah Johnson', 'address__9': '357 Aspen St', 'contact_last_name__9': 'Johnson', 'contact_phone_number__9': '357-951-4860', 'bank_name__9': 'First Republic Bank', 'payment_terms__9': 'Net 30', 'phone__9': '357-951-4860', 'contact_first_name__9': 'Hannah'}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
